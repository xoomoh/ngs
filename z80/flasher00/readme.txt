
  Используемые флешки

 Применяются флеши с объёмом 512кб и страничками по 64кб (стираются независимо).
Пока флешер заточен на одну только флешку (m29f040b от ST microelectronics),
но можно добавлять и другие, соответствующие вышеуказанным требованиям.
Для m29f040b: manufacturer code = $20, device code = $E2.


  Версионность

 Версия представляет собой идентификатор прошивки FPGA, которая (вместе с загрузчиком
при включении питания и нажатии кнопки сброса) располагается в последней страничке
flash. При этом, поскольку прошивка запакована, используется далеко не весь объём
странички и в конце идут FF'ы. Идентификатор версии хранится в последних восьми байтах
странички (адреса в страничке $FFF8-$FFFF)

Состав идентификатора следующий:

 +0..+5  - произвольная символьная строка, добитая до длины 6 байт пробелами (нуля на конце нет!)
 +6..+7  - 16-битная величина в формате big-endian (старший байт первый), обозначающая дату
           релиза данной версии и которая и служит для сравнения версий.

Формат 16-битной величины (биты пронумерованы начиная с младшего номером ноль)

бит  15     - бит "официальности"
биты 14..09 - год даты (8...63), 6 бит
биты 08..05 - месяц даты (1..12), 4 бита
биты 04..00 - день даты (1..31), 5 бит

Внимание! Данные в полях хранятся НЕ В BCD-формате, а в обычном двоичном представлении.


Можно выделить следующие случаи:

1. все 8 байт равны $FF - версия в данной прошивке не указана
2. присутсвует явная нелепость (непечатные символы в строке (00, FF) или левый день или месяц, например нулевой или 15, и т.д.)
3. всё в порядке, бит официальности = 0
4. всё в порядке, бит официальности = 1

в 1 и 2 случаях версию узнать невозможно.

в 3 случае она ни о чём не говорит - может являться отдельной веткой, не связанной
по функциональности с официальными релизами. Механизм сравнений не определён.

в 4 случае программа может сравнить требуемую ей версию с имеющейся (по дате), а также
вывести на печать строку. Внимание! В данном случае строка служит лишь для показа её
пользователю и никак не для идентификации версии.


  Рекомендация.

 При условии корректности даты в флеши в виде 16-битной величины сравнить версии можно, вычтя
из требуемой считанную из флеши 16-битную величину, причём обе величины рассматриваются как
беззнаковые двоичные числа. Если число, соответсвующее требуемой версии, оказалось меньше или равно
считанному, то считаем, что версия подходит, иначе - не подходит. При этом автоматически учитывается
бит официальности: если он равен 0 в считанной величине, то число требуемой версии (с этим битом = 1)
окажется всегда больше.

