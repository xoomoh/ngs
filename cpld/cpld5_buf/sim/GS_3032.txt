   Функции epm3032 в ньюГСе


 I.

Коммутировать клок. На вход идут 24 и 20 мгц, сигналы выбора клока,
на выходе - выбранный клок.

входы:
clk24in - 24мгц
clk20in - 20мгц
clkout - выход (клок на Z80 и главную ФПГУ)
clksel1 - выбор
clksel2 -      клока

{clksel1,clksel2}  |  Частота, МГц
-------------------+----------
   0        0      |  24
   0        1      |  12
   1        0      |  20
   1        1      |  10


 II.

Рулить памятью зетника, когда основная фпга не загружена и её надо загрузить. Фичи:

вход cold reset (coldres_n), по нему генерится warmres_n и nCONFIG на фпга, сбрасывается проц и фпга в режим
конфигурирования вводится.

В этом режиме старшие адреса памяти и ЦСы - пуллаплены 1ком, 3032 рулит только mema14 и mema15, romcs_n и ramcs0_n,
т.е. видятся старшие 64кб 1ой мсх ОЗУ и ПЗУ.
маппинг:
0000-3fff - первые 16кб ПЗУ (из вышеуказанного куска 64кб)
4000-7fff - первые 16кб ОЗУ
8000-ffff - любая половинка 64кб ОЗУ или ПЗУ, см. описание портов.

Порты (младший адрес, старший - пофигу)

%00xxxxxx - для ФПГА
%01xxxxxx, чтение: d7=cold reset flag, 0 - был cold reset, 1 - не было
%01хххххх, запись: d7=1 в 32кб страничке ОЗУ,0 - ПЗУ, d0=0 младшие 32к в страничке,1 - старшие (см. выше)
%10xxxxxx, чтение: d7 - nSTATUS, d0 - CONF_DONE
%10xxxxxx, запись: d7=1 - установить в 1 cold reset flag, 0 - не менять; d0 - задать nCONFIG
%11xxxxxx, запись байта конфигурации в ФПГА
%11xxxxxx, чтение байта готовности из ФПГА

с проца идут сигналы:
a14,a15,a6,a7,d7,d0
/iorq, /mreq, /rd, /wr
на проц: /res (к warmres_n)

на память:
mema14,mema15,ramcs0_n,romcs_n,memoe_n,memwe_n

с генератора сброса/кнопки: coldres_n

на/с ФПГА:
nCONFIG, nSTATUS, CONF_DONE
ещё: cs,INIT_DONE

Как 3032 узнаёт, когда она рулит, а когда ФПГА:

1. по сигналу coldres_n она генерит ФПГАшке nCONFIG в ноль, а также warmres_n (на проц),
2. сигнал nCONFIG сбрасывает асинхронно триггер 'рулерства', т.е. 3032 считает, что она рулит
памятью для проца.
3. Положительный фронт INIT_DONE устанавливает триггер 'рулерства', т.е. теперь ФПГАшка
рулит памятью и всем остальным, при этом сразу же выдаётся импульс warmres_n, сбрасывающий проц и ФПГАшку
(уже отконфигуренную), и проц начинает работу уже про ФПГАшкой.
4. если хочется переконфигуриться на ходу, через порт обнуляем nCONFIG. Сброса при этом не будет, но
контроль над памятью вернётся к 3032, тут надо сделать так, чтобы проц продолжил выполнять осмысленную программу.
Далее, по приходу INIT_DONE проц+ФПГА сбросятся. Совсем налету - не выйдет.

Триггер 'рулерства' рулит:

Z-состоянием сигналов управления памятью, сигналом cs на ФПГА.

